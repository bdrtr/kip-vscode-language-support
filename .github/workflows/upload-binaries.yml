name: Upload Binaries to Extension Release

on:
  workflow_dispatch:
    inputs:
      release_tag:
        description: 'Release tag (e.g., v1.1.0)'
        required: true
        type: string
      binary_url_linux:
        description: 'URL to Linux binary'
        required: false
        type: string
      binary_url_macos_x64:
        description: 'URL to macOS Intel binary'
        required: false
        type: string
      binary_url_macos_arm64:
        description: 'URL to macOS ARM binary'
        required: false
        type: string
      binary_url_windows:
        description: 'URL to Windows binary'
        required: false
        type: string

jobs:
  upload:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download and upload binaries
        run: |
          TAG="${{ github.event.inputs.release_tag }}"
          
          # Binary'leri indir ve y√ºkle
          if [ -n "${{ github.event.inputs.binary_url_linux }}" ]; then
            echo "Downloading Linux binary..."
            curl -L -o kip-linux-x64 "${{ github.event.inputs.binary_url_linux }}"
            chmod +x kip-linux-x64
            gh release upload "$TAG" kip-linux-x64 --clobber || echo "Release not found, will create"
          fi
          
          if [ -n "${{ github.event.inputs.binary_url_macos_x64 }}" ]; then
            echo "Downloading macOS Intel binary..."
            curl -L -o kip-darwin-x64 "${{ github.event.inputs.binary_url_macos_x64 }}"
            chmod +x kip-darwin-x64
            gh release upload "$TAG" kip-darwin-x64 --clobber || echo "Release not found, will create"
          fi
          
          if [ -n "${{ github.event.inputs.binary_url_macos_arm64 }}" ]; then
            echo "Downloading macOS ARM binary..."
            curl -L -o kip-darwin-arm64 "${{ github.event.inputs.binary_url_macos_arm64 }}"
            chmod +x kip-darwin-arm64
            gh release upload "$TAG" kip-darwin-arm64 --clobber || echo "Release not found, will create"
          fi
          
          if [ -n "${{ github.event.inputs.binary_url_windows }}" ]; then
            echo "Downloading Windows binary..."
            curl -L -o kip-win32-x64.exe "${{ github.event.inputs.binary_url_windows }}"
            gh release upload "$TAG" kip-win32-x64.exe --clobber || echo "Release not found, will create"
          fi
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
